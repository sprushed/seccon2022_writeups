# DoroboH
Basically, what this malware does is exchange of keys with attacker with diffie-hellman, then, after  key is established, it is used to decrypt command from server that are encrypted with rc4. To solve this challenge one should understand true layout of `HCRYPTKEY`, which contains encrypted pointer to next internal structure, which contains key by specific offset. Attacker's ip address is `192.168.3.6`. Pointer is encrypted by xoring it with value `0xA2491D83D96214A0`. The easiest way to find this pointer is search memory for pointer to function `dssenh_CPDecrypt`. There will be 3 of them, and one of them will have rc4 key. IdaPython script `get_bytes(get_qword((get_qword(here()+0x18)^0xA2491D83D96214A0)+0x48), 16)` will find key if cursor is on pointer to `dssenh_CPDecrypt`.
`b'/C echo "SECCON{M3m0ry_Dump+P4ck3t_C4ptur3=S0ph1st1c4t3d_F0r3ns1cs}" > C:\\Users\\ctf\\Desktop\\flag.txt\r\n\x00'` is the first command of 2.